/**
 * ç½‘æ˜“äº‘éŸ³ä¹è¡¨æƒ…æ˜ å°„å·¥å…·
 * å°†æ–‡å­—è¡¨æƒ…è½¬æ¢ä¸ºemojiæˆ–å›¾ç‰‡è¡¨æƒ…
 */

// ç½‘æ˜“äº‘éŸ³ä¹å®˜æ–¹è¡¨æƒ…åŠå¸¸ç”¨è¡¨æƒ…æ˜ å°„è¡¨
export const ALL_EMOJI_MAP = {
  // å¼€å¿ƒç±»
  '[å‘²ç‰™]': 'ğŸ˜ƒ',
  '[å¤§ç¬‘]': 'ğŸ˜†',
  '[å¯çˆ±]': 'ğŸ˜Š',
  '[è‰²]': 'ğŸ˜',
  '[å¾—æ„]': 'ğŸ˜',
  '[å˜¿å“ˆ]': 'ğŸ˜„',
  '[ç¬‘å“­]': 'ğŸ˜‚',
  '[å¥¸ç¬‘]': 'ğŸ˜ˆ',
  '[æ†¨ç¬‘]': 'ğŸ˜',
  '[æœºæ™º]': 'ğŸ¤“',
  '[æƒŠå–œ]': 'ğŸ¤©',
  '[é€å¿ƒ]': 'ğŸ¥°',
  '[è°ƒçš®]': 'ğŸ˜œ',
  '[èˆ”å±]': 'ğŸ˜‹',
  '[å“‡]': 'ğŸ˜®',
  '[èµ]': 'ğŸ‘',
  '[å·ç¬‘]': 'ğŸ¤­',
  '[æ„‰å¿«]': 'ğŸ˜',
  '[å˜»å˜»]': 'ğŸ˜„',
  '[Mufasa]': 'ğŸ¦',

  // éš¾è¿‡ç±»
  '[æ³ª]': 'ğŸ˜¢',
  '[å¤§å“­]': 'ğŸ˜­',
  '[æ‚²ä¼¤]': 'ğŸ˜”',
  '[æµæ³ª]': 'ğŸ˜­',
  '[å¯æ€œ]': 'ğŸ¥º',
  '[å§”å±ˆ]': 'ğŸ˜ª',
  '[å¤±æœ›]': 'ğŸ˜',
  '[å¿ƒç¢]': 'ğŸ’”',
  '[è£‚å¼€]': 'ğŸ˜µ',
  '[æŠ±æŠ±]': 'ğŸ¤—',
  '[çš±çœ‰]': 'ğŸ˜Ÿ',
  '[ä¸§]': 'ğŸ˜',
  '[å¹æ°”]': 'ğŸ˜®â€ğŸ’¨',

  // ç”Ÿæ°”ç±»
  '[æ€’]': 'ğŸ˜ ',
  '[æŠ“ç‹‚]': 'ğŸ¤¬',
  '[ç”Ÿæ°”]': 'ğŸ˜¡',
  '[å‘ç«]': 'ğŸ˜¤',
  '[é„™è§†]': 'ğŸ™„',
  '[ç™½çœ¼]': 'ğŸ™„',
  '[å‚²æ…¢]': 'ğŸ˜¤',
  '[ä¸å±‘]': 'ğŸ˜’',
  '[å†·æ¼ ]': 'ğŸ˜‘',

  // æƒŠè®¶/ç–‘é—®ç±»
  '[æƒŠæ]': 'ğŸ˜±',
  '[éœ‡æƒŠ]': 'ğŸ˜²',
  '[æƒŠè®¶]': 'ğŸ˜®',
  '[å‘†]': 'ğŸ˜',
  '[æ— è¯­]': 'ğŸ˜‘',
  '[ç–‘é—®]': 'â“',
  '[æ™•]': 'ğŸ˜µ',
  '[æ±—]': 'ğŸ˜…',
  '[æ€è€ƒ]': 'ğŸ¤”',
  '[çŸ³åŒ–]': 'ğŸ—¿',
  '[what]': 'ğŸ¤”',
  '[é»‘çº¿]': 'ğŸ˜‘',
  '[é—®å·]': 'â“',
  '[æƒŠè®¶]': 'ğŸ˜¯',
  '[æ±—]': 'ğŸ˜“',

  // å…¶ä»–æƒ…ç»ª/çŠ¶æ€
  '[ç¡]': 'ğŸ˜´',
  '[å‘•å]': 'ğŸ¤®',
  '[é…·]': 'ğŸ˜',
  '[é˜´é™©]': 'ğŸ˜',
  '[å®³ç¾]': 'ğŸ˜³',
  '[é—­å˜´]': 'ğŸ¤',
  '[é¬¼è„¸]': 'ğŸ˜',
  '[å›°]': 'ğŸ˜ª',
  '[ç”Ÿç—…]': 'ğŸ˜·',
  '[å£ç½©]': 'ğŸ˜·',
  '[OK]': 'ğŸ‘Œ',
  '[æ‚è„¸]': 'ğŸ¤¦',
  '[ææƒ§]': 'ğŸ˜¨',
  '[æŠ é¼»]': 'ğŸ™„',
  '[æ’‡å˜´]': 'ğŸ˜’',
  '[å›§]': 'å›§',

  // æ‰‹åŠ¿ç±»
  '[å¼º]': 'ğŸ‘',
  '[å¼±]': 'ğŸ‘',
  '[æ‹³å¤´]': 'âœŠ',
  '[èƒœåˆ©]': 'âœŒï¸',
  '[good]': 'ğŸ‘',
  '[no]': 'ğŸ™…',
  '[åŠ æ²¹]': 'ğŸ’ª',
  '[é¼“æŒ]': 'ğŸ‘',
  '[ç¥ˆç¥·]': 'ğŸ™',
  '[ä½œæ–]': 'ğŸ™',
  '[æ¡æ‰‹]': 'ğŸ¤',
  '[æŠ±æ‹³]': 'ğŸ™',
  '[å‹¾å¼•]': 'ğŸ˜',
  
  // ç‰©å“/ç¬¦å·ç±»
  '[çˆ±å¿ƒ]': 'â¤ï¸',
  '[ç«ç‘°]': 'ğŸŒ¹',
  '[å‡‹è°¢]': 'ğŸ¥€',
  '[å¤ªé˜³]': 'â˜€ï¸',
  '[æœˆäº®]': 'ğŸŒ™',
  '[ä¸‹é›¨]': 'ğŸŒ§ï¸',
  '[æ˜Ÿæ˜Ÿ]': 'â­',
  '[éŸ³ä¹]': 'ğŸµ',
  '[ç¤¼ç‰©]': 'ğŸ',
  '[è›‹ç³•]': 'ğŸ‚',
  '[å’–å•¡]': 'â˜•',
  '[å•¤é…’]': 'ğŸº',
  '[é£æœº]': 'âœˆï¸',
  '[æ±½è½¦]': 'ğŸš—',
  '[çº¢åŒ…]': 'ğŸ§§',
  '[ç‚¸å¼¹]': 'ğŸ’£',
  '[åˆ€]': 'ğŸ”ª',
  '[èœåˆ€]': 'ğŸ”ª',
  '[åº†ç¥]': 'ğŸ‰',
  '[ç£•å¤´]': 'ğŸ™‡',
  '[å›å¤´]': 'ğŸ‘€',
  '[è·³ç»³]': 'ğŸ’ƒ',
  '[æŒ¥æ‰‹]': 'ğŸ‘‹',
  '[æ¿€åŠ¨]': 'ğŸ¤©',
  '[è¡—èˆ]': 'ğŸ•º',
  '[çŒ®å»]': 'ğŸ˜˜',
  '[å·¦å¤ªæ]': 'â˜¯ï¸',
  '[å³å¤ªæ]': 'â˜¯ï¸',
  
  // åŠ¨ç‰©ç±»
  '[çŒªå¤´]': 'ğŸ·',
  '[ç†ŠçŒ«]': 'ğŸ¼',
  '[å…”å­]': 'ğŸ°',
  '[å°é¸¡]': 'ğŸ¥',
  '[å°ç‹—]': 'ğŸ¶',
  '[å°çŒ«]': 'ğŸ±',
  '[ç¾Š]': 'ğŸ‘',
  '[ç¥å…½]': 'ğŸ¦™', // è‰æ³¥é©¬
  '[é¸¡]': 'ğŸ”',
  '[é¸­]': 'ğŸ¦†',
  '[é’è›™]': 'ğŸ¸',
  
  // å¤šå¤šç³»åˆ—ï¼ˆç‰¹æ®Šï¼‰
  '[å¤šå¤šå¼€å¿ƒ]': 'ğŸ˜Šâœ¨',
  '[å¤šå¤šå¯çˆ±]': 'ğŸ¥°ğŸ’•',
  '[å¤šå¤šå¾—æ„]': 'ğŸ˜ğŸµ',
  '[å¤šå¤šå¤§å“­]': 'ğŸ˜­ğŸ’§',
  '[å¤šå¤šéš¾è¿‡]': 'ğŸ˜”ğŸ’”',
  '[å¤šå¤šç”Ÿç—…]': 'ğŸ˜·ğŸ’Š',
  '[å¤šå¤šå›°]': 'ğŸ˜´ğŸ’¤',
  '[å¤šå¤šæƒŠè®¶]': 'ğŸ˜¯âš¡',
  '[å¤šå¤šåƒé¥­]': 'ğŸ˜‹ğŸš',
  '[å¤šå¤šç¡è§‰]': 'ğŸ˜´ğŸ›ï¸',
  '[å¤šå¤šéŸ³ä¹]': 'ğŸµğŸ§',
  '[å¤šå¤šçˆ±å¿ƒ]': 'â¤ï¸ğŸ’•',
  '[å¤šå¤šæ‹¥æŠ±]': 'ğŸ¤—ğŸ’™',
  '[å¤šå¤šåŠ æ²¹]': 'ğŸ’ªâš¡',

  // å…¶ä»–
  '[ç¬‘]': 'ğŸ˜„',
  '[å“­]': 'ğŸ˜­',
  '[å“ˆå“ˆ]': 'ğŸ˜‚',
  '[å‘µå‘µ]': 'ğŸ˜Š',
  '[å˜¿å˜¿]': 'ğŸ˜',
  '[å—¯]': 'ğŸ¤”',
  '[å—¯å—¯]': 'ğŸ˜Œ',
  '[å“¦]': 'ğŸ˜¯',
  '[å”‰]': 'ğŸ˜”',
  '[å˜˜]': 'ğŸ¤«',
  '[å]': 'ğŸ¤®',
  '[æµé¼»æ¶•]': 'ğŸ¤§',
  '[æ— å¥ˆ]': 'ğŸ˜¤',
  '[å’³]': 'ğŸ˜·',
  '[å˜¿]': 'ğŸ˜„',
  '[æ’’èŠ±]': 'ğŸ‰',
  '[æµæ„Ÿ]': 'ğŸ¤§ğŸ¤’',
  '[æ„Ÿå†’]': 'ğŸ¤§',
  '[å‘çƒ§]': 'ğŸ¤’',
  '[å•Š]': 'ğŸ˜®',
  '[å’¦]': 'ğŸ¤¨',
  '[æ‘¸å¤´]': 'ğŸ˜…',
  '[ç§€æ©çˆ±]': 'ğŸ’•'
};

/**
 * å°†è¯„è®ºæ–‡æœ¬ä¸­çš„è¡¨æƒ…æ–‡å­—è½¬æ¢ä¸ºemoji
 * @param {string} text - åŒ…å«è¡¨æƒ…æ–‡å­—çš„æ–‡æœ¬
 * @returns {string} è½¬æ¢åçš„æ–‡æœ¬
 */
export function parseEmoji(text) {
  if (!text || typeof text !== 'string') {
    return text;
  }

  let parsedText = text;
  
  // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰çš„[è¡¨æƒ…]æ ¼å¼
  const emojiRegex = /\[([^\[\]]+)\]/g;
  
  parsedText = parsedText.replace(emojiRegex, (match, emojiName) => {
    const fullMatch = `[${emojiName}]`;
    
    // æŸ¥æ‰¾å¯¹åº”çš„emoji
    if (ALL_EMOJI_MAP[fullMatch]) {
      return ALL_EMOJI_MAP[fullMatch];
    }
    
    // å¦‚æœæ²¡æ‰¾åˆ°å¯¹åº”çš„emojiï¼Œä¿ç•™åŸæ–‡
    return match;
  });
  
  return parsedText;
}

/**
 * æ£€æŸ¥æ–‡æœ¬æ˜¯å¦åŒ…å«è¡¨æƒ…
 * @param {string} text - è¦æ£€æŸ¥çš„æ–‡æœ¬
 * @returns {boolean} æ˜¯å¦åŒ…å«è¡¨æƒ…
 */
export function hasEmoji(text) {
  if (!text || typeof text !== 'string') {
    return false;
  }
  
  const emojiRegex = /\[([^\[\]]+)\]/;
  return emojiRegex.test(text);
}

/**
 * è·å–æ–‡æœ¬ä¸­æ‰€æœ‰çš„è¡¨æƒ…
 * @param {string} text - è¦åˆ†æçš„æ–‡æœ¬
 * @returns {Array} è¡¨æƒ…æ•°ç»„
 */
export function extractEmojis(text) {
  if (!text || typeof text !== 'string') {
    return [];
  }
  
  const emojiRegex = /\[([^\[\]]+)\]/g;
  const matches = text.match(emojiRegex) || [];
  
  return matches.filter(match => ALL_EMOJI_MAP[match]);
}

/**
 * å°†æ–‡æœ¬åˆ†å‰²ä¸ºæ–‡å­—å’Œè¡¨æƒ…çš„æ··åˆæ•°ç»„
 * @param {string} text - è¦åˆ†æçš„æ–‡æœ¬
 * @returns {Array} åŒ…å«{type: 'text'|'emoji', content: string}çš„æ•°ç»„
 */
export function parseTextWithEmoji(text) {
  if (!text || typeof text !== 'string') {
    return [{ type: 'text', content: text || '' }];
  }

  const result = [];
  const emojiRegex = /\[([^\[\]]+)\]/g;
  let lastIndex = 0;
  let match;

  while ((match = emojiRegex.exec(text)) !== null) {
    const fullMatch = match[0]; // [è¡¨æƒ…]
    const startIndex = match.index;
    
    // æ·»åŠ è¡¨æƒ…å‰çš„æ–‡å­—
    if (startIndex > lastIndex) {
      const textBefore = text.substring(lastIndex, startIndex);
      if (textBefore) {
        result.push({ type: 'text', content: textBefore });
      }
    }
    
    // æ·»åŠ è¡¨æƒ…
    if (ALL_EMOJI_MAP[fullMatch]) {
      result.push({ 
        type: 'emoji', 
        content: ALL_EMOJI_MAP[fullMatch],
        original: fullMatch 
      });
    } else {
      // å¦‚æœä¸æ˜¯è¯†åˆ«çš„è¡¨æƒ…ï¼Œå½“ä½œæ™®é€šæ–‡å­—å¤„ç†
      result.push({ type: 'text', content: fullMatch });
    }
    
    lastIndex = startIndex + fullMatch.length;
  }
  
  // æ·»åŠ æœ€åå‰©ä½™çš„æ–‡å­—
  if (lastIndex < text.length) {
    const remainingText = text.substring(lastIndex);
    if (remainingText) {
      result.push({ type: 'text', content: remainingText });
    }
  }
  
  return result.length > 0 ? result : [{ type: 'text', content: text }];
}